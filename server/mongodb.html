<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/imgs/favicon.ico"><title>MongoDB | Jason的前端笔记</title><meta name="description" content="全栈工程师成长记录">
    <link rel="modulepreload" href="/WebNotebook/assets/app.a696b835.js"><link rel="modulepreload" href="/WebNotebook/assets/mongodb.html.4c0b6536.js"><link rel="modulepreload" href="/WebNotebook/assets/mongodb.html.27b6dc1f.js"><link rel="prefetch" href="/WebNotebook/assets/index.html.0dfa6503.js"><link rel="prefetch" href="/WebNotebook/assets/css.html.5e071627.js"><link rel="prefetch" href="/WebNotebook/assets/html.html.b0837913.js"><link rel="prefetch" href="/WebNotebook/assets/js.html.7d413f4e.js"><link rel="prefetch" href="/WebNotebook/assets/ts.html.4c5868f3.js"><link rel="prefetch" href="/WebNotebook/assets/tsplus.html.eed3e11b.js"><link rel="prefetch" href="/WebNotebook/assets/index.html.e6dfb4a7.js"><link rel="prefetch" href="/WebNotebook/assets/ajax.html.3a9c28f6.js"><link rel="prefetch" href="/WebNotebook/assets/axios.html.b17231bb.js"><link rel="prefetch" href="/WebNotebook/assets/git.html.2e4cf940.js"><link rel="prefetch" href="/WebNotebook/assets/nodejs.html.93569260.js"><link rel="prefetch" href="/WebNotebook/assets/webpack.html.ad4d557e.js"><link rel="prefetch" href="/WebNotebook/assets/vue2.html.c8988b10.js"><link rel="prefetch" href="/WebNotebook/assets/vue3.html.5733ae73.js"><link rel="prefetch" href="/WebNotebook/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/WebNotebook/assets/index.html.ce113d46.js"><link rel="prefetch" href="/WebNotebook/assets/css.html.f5e9f701.js"><link rel="prefetch" href="/WebNotebook/assets/html.html.85f0cdcd.js"><link rel="prefetch" href="/WebNotebook/assets/js.html.1d64cb3a.js"><link rel="prefetch" href="/WebNotebook/assets/ts.html.9672c300.js"><link rel="prefetch" href="/WebNotebook/assets/tsplus.html.7e2c646e.js"><link rel="prefetch" href="/WebNotebook/assets/index.html.af744433.js"><link rel="prefetch" href="/WebNotebook/assets/ajax.html.31564145.js"><link rel="prefetch" href="/WebNotebook/assets/axios.html.4e96b5e7.js"><link rel="prefetch" href="/WebNotebook/assets/git.html.b022183f.js"><link rel="prefetch" href="/WebNotebook/assets/nodejs.html.c6372b0a.js"><link rel="prefetch" href="/WebNotebook/assets/webpack.html.1b12bad9.js"><link rel="prefetch" href="/WebNotebook/assets/vue2.html.ce183888.js"><link rel="prefetch" href="/WebNotebook/assets/vue3.html.90369fb3.js"><link rel="prefetch" href="/WebNotebook/assets/404.html.9d06ec28.js"><link rel="prefetch" href="/WebNotebook/assets/404.a8bab9bc.js"><link rel="prefetch" href="/WebNotebook/assets/Layout.300f0ece.js">
    <link rel="stylesheet" href="/WebNotebook/assets/style.46da2986.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/WebNotebook/" class=""><img class="logo" src="/WebNotebook/imgs/cosmos.png" alt="Jason的前端笔记"><span class="site-name can-hide">Jason的前端笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/WebNotebook/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Base"><span class="title">Base</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Base"><span class="title">Base</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/WebNotebook/base/html" class="" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/js" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/ts" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/tsplus" class="" aria-label="TypeScript+"><!--[--><!--]--> TypeScript+ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Server"><span class="title">Server</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Server"><span class="title">Server</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础通讯</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/git" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/ajax" class="" aria-label="Ajax"><!--[--><!--]--> Ajax <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/axios" class="" aria-label="Axios"><!--[--><!--]--> Axios <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端开发</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/nodejs" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/mongodb" class="router-link-active" aria-label="MongoDB"><!--[--><!--]--> MongoDB <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>项目打包</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/webpack" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/WebNotebook/vue/vue2" class="" aria-label="Vue2"><!--[--><!--]--> Vue2 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/vue/vue3" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/WebNotebook/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jrothschild33/WebNotebook" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/WebNotebook/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Base"><span class="title">Base</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Base"><span class="title">Base</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/WebNotebook/base/html" class="" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/js" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/ts" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/base/tsplus" class="" aria-label="TypeScript+"><!--[--><!--]--> TypeScript+ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Server"><span class="title">Server</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Server"><span class="title">Server</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础通讯</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/git" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/ajax" class="" aria-label="Ajax"><!--[--><!--]--> Ajax <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/axios" class="" aria-label="Axios"><!--[--><!--]--> Axios <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端开发</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/nodejs" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/mongodb" class="router-link-active" aria-label="MongoDB"><!--[--><!--]--> MongoDB <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>项目打包</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/WebNotebook/server/webpack" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/WebNotebook/vue/vue2" class="" aria-label="Vue2"><!--[--><!--]--> Vue2 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/WebNotebook/vue/vue3" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/WebNotebook/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jrothschild33/WebNotebook" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Communicate <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/WebNotebook/server/git.html" class="sidebar-item" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a><!----></li><li><a href="/WebNotebook/server/ajax.html" class="sidebar-item" aria-label="Ajax"><!--[--><!--]--> Ajax <!--[--><!--]--></a><!----></li><li><a href="/WebNotebook/server/axios.html" class="sidebar-item" aria-label="Axios"><!--[--><!--]--> Axios <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">Server Dev <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/WebNotebook/server/nodejs.html" class="sidebar-item" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="MongoDB"><!--[--><!--]--> MongoDB <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#第1章-mongodb概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="第1章 MongoDB概述"><!--[--><!--]--> 第1章 MongoDB概述 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_1-1-数据库分类" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 数据库分类"><!--[--><!--]--> 1.1 数据库分类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_1-2-mongodb简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 MongoDB简介"><!--[--><!--]--> 1.2 MongoDB简介 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_1-3-下载与安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 下载与安装"><!--[--><!--]--> 1.3 下载与安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_1-4-常用命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4 常用命令"><!--[--><!--]--> 1.4 常用命令 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#第2章-mongodb操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="第2章 MongoDB操作"><!--[--><!--]--> 第2章 MongoDB操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-1-数据库与集合" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 数据库与集合"><!--[--><!--]--> 2.1 数据库与集合 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-2-插入文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 插入文档"><!--[--><!--]--> 2.2 插入文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-3-查询文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 查询文档"><!--[--><!--]--> 2.3 查询文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-4-修改文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 修改文档"><!--[--><!--]--> 2.4 修改文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-5-删除文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5 删除文档"><!--[--><!--]--> 2.5 删除文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-6-操作符" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.6 操作符"><!--[--><!--]--> 2.6 操作符 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-6-1-修改操作符" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.6.1 修改操作符"><!--[--><!--]--> 2.6.1 修改操作符 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-6-2-查询操作符" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.6.2 查询操作符"><!--[--><!--]--> 2.6.2 查询操作符 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_2-7-文档关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.7 文档关系"><!--[--><!--]--> 2.7 文档关系 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#第3章-mongoose" class="router-link-active router-link-exact-active sidebar-item" aria-label="第3章 Mongoose"><!--[--><!--]--> 第3章 Mongoose <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-1-mongoose简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 Mongoose简介"><!--[--><!--]--> 3.1 Mongoose简介 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-2-连接mongodb" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 连接MongoDB"><!--[--><!--]--> 3.2 连接MongoDB <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-3-schema模式对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 Schema模式对象"><!--[--><!--]--> 3.3 Schema模式对象 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-4-model模型对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4 Model模型对象"><!--[--><!--]--> 3.4 Model模型对象 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-4-1-创建model" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.1 创建Model"><!--[--><!--]--> 3.4.1 创建Model <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-4-2-创建文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.2 创建文档"><!--[--><!--]--> 3.4.2 创建文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-4-3-查询文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.3 查询文档"><!--[--><!--]--> 3.4.3 查询文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-4-4-修改文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.4 修改文档"><!--[--><!--]--> 3.4.4 修改文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-4-5-删除文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.5 删除文档"><!--[--><!--]--> 3.4.5 删除文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-4-6-统计数量" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.4.6 统计数量"><!--[--><!--]--> 3.4.6 统计数量 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-5-document文档对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.5 Document文档对象"><!--[--><!--]--> 3.5 Document文档对象 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/WebNotebook/server/mongodb.html#_3-6-mongoose模块化" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.6 Mongoose模块化"><!--[--><!--]--> 3.6 Mongoose模块化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Packaging <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/WebNotebook/server/webpack.html" class="sidebar-item" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="mongodb" tabindex="-1"><a class="header-anchor" href="#mongodb" aria-hidden="true">#</a> MongoDB</h1><h2 id="第1章-mongodb概述" tabindex="-1"><a class="header-anchor" href="#第1章-mongodb概述" aria-hidden="true">#</a> 第1章 MongoDB概述</h2><h3 id="_1-1-数据库分类" tabindex="-1"><a class="header-anchor" href="#_1-1-数据库分类" aria-hidden="true">#</a> 1.1 数据库分类</h3><ol><li><p>关系型数据库：</p><p>1）特点：关系数据库中全都是表，需要通过SQL语言操作</p><p>2）包含：MySQL、Oracle、DB2、SQL Server</p></li><li><p>非关系型数据库</p><p>1）特点：键值对数据库</p><p>2）包含：MongoDB、Redis</p></li></ol><hr><h3 id="_1-2-mongodb简介" tabindex="-1"><a class="header-anchor" href="#_1-2-mongodb简介" aria-hidden="true">#</a> 1.2 MongoDB简介</h3><blockquote><p>MongoDB是为快速开发互联网Web应用而设计的数据库系统，是一个NoSQL、文档型的数据库</p></blockquote><img src="/WebNotebook/imgs/server/mongodb基本结构.png" alt="mongodb基本结构"><ol><li><p>设计目标：极简、灵活、作为Web应用栈的一部分</p></li><li><p>面向文档的数据模型：所谓文档是一种类似于JSON的结构，可以理解MongoDB存的是各种各样的JSON(BSON)，比普通的JSON的功能要更加的强大</p></li><li><p>MongoDB数据库使用JavaScript进行操作，在MongoDB含有一个对ES标准实现的引擎，在MongoDB中所有ES中的语法中都可以使用</p></li><li><p>MongoDB中的数据库和集合都不需要手动创建，当创建文档时，若文档所在的数据库或集合不存在，会自动创建数据库和集合</p></li><li><p>基本概念：</p><p>1）数据库(database)：数据库是一个仓库，在仓库中可以存放集合</p><p>2）集合(collection)：类似于数组，在集合中可以存放文档，文档可以是各种各样的，没有格式要求</p><p>3）文档(document)：文档数据库中的最小单位，存储和操作的内容都是文档，类似于JS中的对象，在MongoDB中每一条数据都是一个文档</p></li></ol><hr><h3 id="_1-3-下载与安装" tabindex="-1"><a class="header-anchor" href="#_1-3-下载与安装" aria-hidden="true">#</a> 1.3 下载与安装</h3><blockquote><p>官网地址：<a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noopener noreferrer">https://www.mongodb.com/try/download/community<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><img src="/WebNotebook/imgs/server/mongodb下载.png" alt="mongodb下载"><ol><li><p>版本说明：MongoDB的版本偶数版本为稳定版，奇数版本为开发版，对于32位系统支持不佳</p></li><li><p>目前版本：截止2022年6月10日，推荐安装版本：5.0.9</p></li><li><p>下载安装包后，选择完整安装，并选择路径（不推荐C盘，选择空间较大的磁盘），勾选安装compass</p></li><li><p>安装完成后，将C盘的bin目录添加到系统变量path中：</p><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>C:\Program Files\MongoDB\Server\5.0\bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>启动MongoDB：</p><p>1）CMD输入</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mongo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）浏览器访问：127.0.0.1:27017，出现以下提示则说明安装成功</p><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>It looks like you are trying to access MongoDB over HTTP on the native driver port.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>数据库路径：</p><p>1）如果是默认安装，则位于MongoDB的<code>server/5.0/data</code>目录下</p><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>...\MongoDB\Server\5.0\data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）可以手动创建数据库文件夹，如：<code>D:\MongoData</code>，在该路径下打开cmd执行以下命令可指定数据库运行端口</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mongod --dbpath D:<span class="token punctuation">\</span>MongoData --port <span class="token number">10086</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>图形化操作软件：<a href="https://www.mongodb.com/products/compass" target="_blank" rel="noopener noreferrer">MongoDB Compass(官方)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://www.mongodbmanager.com/" target="_blank" rel="noopener noreferrer">MongoDB Manager<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://studio3t.com/" target="_blank" rel="noopener noreferrer">Studio 3T<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ol><hr><h3 id="_1-4-常用命令" tabindex="-1"><a class="header-anchor" href="#_1-4-常用命令" aria-hidden="true">#</a> 1.4 常用命令</h3><ol><li><p>MongoDB：CMD输入命令<code>mongod</code></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">--help –h</td><td style="text-align:left;">返回基本帮助和用法文本</td></tr><tr><td style="text-align:left;">--version</td><td style="text-align:left;">返回MongoDB的版本</td></tr><tr><td style="text-align:left;">--config&lt;文件名&gt; -f&lt;文件名&gt;</td><td style="text-align:left;">指定包含运行时配置的配置文件</td></tr><tr><td style="text-align:left;">--verbose -v</td><td style="text-align:left;">增加发送到控制台日志的数量</td></tr><tr><td style="text-align:left;">--quiet</td><td style="text-align:left;">减少发送到控制台日志的数量</td></tr><tr><td style="text-align:left;">--port&lt;端口&gt;</td><td style="text-align:left;">指定mongod的端口，默认27017</td></tr><tr><td style="text-align:left;">--bind_ip&lt;端口&gt;</td><td style="text-align:left;">指定id地址</td></tr><tr><td style="text-align:left;">--maxConns&lt;编号&gt;</td><td style="text-align:left;">指定链接的最大数</td></tr><tr><td style="text-align:left;">--logpath&lt;路径&gt;</td><td style="text-align:left;">指定日志文件的路径</td></tr><tr><td style="text-align:left;">--auth</td><td style="text-align:left;">启用远程主机的身份验证</td></tr><tr><td style="text-align:left;">--dbpath&lt;路径&gt;</td><td style="text-align:left;">指定数据库实例的路径</td></tr><tr><td style="text-align:left;">--nohttpinterface</td><td style="text-align:left;">禁用HTTP接口</td></tr><tr><td style="text-align:left;">--nojournal</td><td style="text-align:left;">禁用日志</td></tr><tr><td style="text-align:left;">--noprealloc</td><td style="text-align:left;">禁止预分配数据文件</td></tr><tr><td style="text-align:left;">--repair</td><td style="text-align:left;">在所有数据库上运行修复程序</td></tr></tbody></table></li><li><p>Mongo Shell：CMD输入命令<code>mongo</code></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">help <code>&lt;option&gt;</code></td><td style="text-align:left;">语法帮助</td></tr><tr><td style="text-align:left;">use <code>&lt;database&gt;</code></td><td style="text-align:left;">更改当前操作的数据库</td></tr><tr><td style="text-align:left;">db</td><td style="text-align:left;">显示当前所在的数据库</td></tr><tr><td style="text-align:left;">show dbs</td><td style="text-align:left;">显示数据库列表</td></tr><tr><td style="text-align:left;">show collections</td><td style="text-align:left;">显示当前数据库的集合</td></tr><tr><td style="text-align:left;">show profile</td><td style="text-align:left;">显示时间超过1毫秒的system.profile条目</td></tr><tr><td style="text-align:left;">show log[name]</td><td style="text-align:left;">显示登录记忆的最后一段</td></tr><tr><td style="text-align:left;">exit</td><td style="text-align:left;">退出数据库</td></tr><tr><td style="text-align:left;">load(script)</td><td style="text-align:left;">加载js文件</td></tr><tr><td style="text-align:left;">db.auth(username,password)</td><td style="text-align:left;">在当前数据库做身份验证</td></tr></tbody></table></li></ol><hr><h2 id="第2章-mongodb操作" tabindex="-1"><a class="header-anchor" href="#第2章-mongodb操作" aria-hidden="true">#</a> 第2章 <a href="/WebNotebook/docs/ReferenceCards.pdf">MongoDB操作</a></h2><blockquote><p>官方文档：<a href="https://www.mongodb.com/docs/manual/crud/" target="_blank" rel="noopener noreferrer">https://www.mongodb.com/docs/manual/crud/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h3 id="_2-1-数据库与集合" tabindex="-1"><a class="header-anchor" href="#_2-1-数据库与集合" aria-hidden="true">#</a> 2.1 数据库与集合</h3><ol><li><code>use &lt;数据库名&gt;</code>：如果数据库存在则会进入到相应的数据库，如果不存在则会自动创建，一旦进入数据库，则可以使用db来引用当前库</li><li><code>db.dropDatabase()</code>：删除一个数据库</li><li><code>db.createCollection()</code>：创建一个新的集合</li><li><code>db.&lt;collection&gt;.drop()</code>：删除集合</li></ol><hr><h3 id="_2-2-插入文档" tabindex="-1"><a class="header-anchor" href="#_2-2-插入文档" aria-hidden="true">#</a> 2.2 插入文档</h3><ol><li><p><code>db.&lt;collection&gt;.insert()</code>：插入文档</p><p>1）可以用于向集合中添加一个或多个文档，可以传递一个对象，或一个数组</p><p>2）可以将对象或数组中的对象添加进集合中</p><p>3）添加时如果集合或数据库不存在，会自动创建</p><p>4）插入的文档对象默认添加<code>_id</code>属性，是文档的唯一标识（由<code>ObjectId()</code>根据时间戳和机器码生成），也可以手动自定义<code>_id</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// db为test数据库，在stus集合中插入文档</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;猪八戒&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;男&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;男&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;男&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;白骨精&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;女&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;蜘蛛精&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;女&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 向numbers中插入20000条数据</span>
<span class="token comment">// 低效方法：7.2秒（逐条插入）</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">20000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">num</span><span class="token operator">:</span> i <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 高效方法：0.4秒（先生成数组，再统一插入）</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">20000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">num</span><span class="token operator">:</span> i <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.insertOne()</code>：向集合中插入一个文档</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;男&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;白骨精&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;女&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;蜘蛛精&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;女&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 返回结果</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;0&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;沙和尚&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;gender&quot;</span><span class="token operator">:</span> <span class="token string">&quot;男&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;白骨精&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;gender&quot;</span><span class="token operator">:</span> <span class="token string">&quot;女&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;蜘蛛精&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;gender&quot;</span><span class="token operator">:</span> <span class="token string">&quot;女&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;$oid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;62a4be0ea5b6f2343ad22886&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.insertMany()</code>：向集合中插入多个文档</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;男&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;白骨精&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;女&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;蜘蛛精&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;女&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 返回结果</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;$oid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;62a4be2aa5b6f2343ad22887&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;沙和尚&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;gender&quot;</span><span class="token operator">:</span> <span class="token string">&quot;男&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;$oid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;62a4be2aa5b6f2343ad22888&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;白骨精&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;gender&quot;</span><span class="token operator">:</span> <span class="token string">&quot;女&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;$oid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;62a4be2aa5b6f2343ad22889&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;蜘蛛精&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;gender&quot;</span><span class="token operator">:</span> <span class="token string">&quot;女&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="_2-3-查询文档" tabindex="-1"><a class="header-anchor" href="#_2-3-查询文档" aria-hidden="true">#</a> 2.3 查询文档</h3><ol><li><p><code>db.&lt;collection&gt;.find()</code>：查询文档，返回数组</p><p>1）需要一个查询文档作为参数，如果不传该参数，则会返回集合中的所有元素</p><p>2）可以将查询条件以键值对的形式添加到查询文档中：<code>$lt</code>、<code>$lte</code>、<code>$gt</code>、<code>$gte</code>、<code>$ne</code>、<code>$or</code>、<code>$in</code>、<code>$nin</code>、<code>$not</code>、<code>$exists</code>、<code>$and</code>等</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;白骨精&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3）内嵌文档：文档的属性值也可以是一个文档，通过<code>.</code>的形式匹配，属性名必须使用引号</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;吴京&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">movies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;战狼2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;长津湖战役&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&#39;hobby.movies&#39;</span><span class="token operator">:</span> <span class="token string">&#39;hero&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>4）投影：第二个参数中设置，可以选择需要显示的列</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查询结果中只显示ename、sal这两列</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ename</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.findOne()</code>：查询第一个符合条件的文档，返回对象</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.find().count()</code>：查询符合条件的文档的数量</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查询stus集合中的文档总数</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.find().limit(n)</code>：设置显示数据的上限</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查看numbers集合中的前10条数据</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.find().skip(n)</code>：跳过指定数量的数据，常与limit配合使用</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查看numbers集合中的第11条到20条数据</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>	<span class="token comment">// MongoDB会自动调整skip和limit的位置，效果相同</span>
<span class="token comment">// 查看numbers集合中的第21条到30条数据</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.find().sort()</code>：指定文档的排序的规则，1表示升序，-1表示降序</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查询结果按sal升序、empno降序显示</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">empno</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="_2-4-修改文档" tabindex="-1"><a class="header-anchor" href="#_2-4-修改文档" aria-hidden="true">#</a> 2.4 修改文档</h3><ol><li><p><code>db.&lt;collection&gt;.update(&lt;query&gt;,&lt;update&gt;,{upsert,multi,weiteConcern,collation})</code>：修改文档（默认只修改一个）</p><p>1）query：必填，查询符合条件的文档</p><p>2）update：必填，需要更新的内容（默认覆盖原文档）</p><p>3）upsert：选填，默认false，是否在未查询到符合条件的文档时进行插入操作</p><p>4）multi：选填，默认false，是否同时修改多个文档</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 用{ age: 28 }替换 name为&#39;沙和尚&#39;的整条数据（仅第一条）</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.updateOne()</code>：修改集合中的一个文档</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 仅修改name为&#39;猪八戒&#39;的第一条数据中的address属性</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;猪八戒&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;高老庄&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.updateMany()</code>：修改集合中的多个文档</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 修改全部name为&#39;猪八戒&#39;的数据中的address属性</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;猪八戒&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;高老庄&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 使用update，设置multi为true也可以实现</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;猪八戒&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;高老庄&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">multi</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.replaceOne()</code>：替换集合中的一个文档</p></li></ol><hr><h3 id="_2-5-删除文档" tabindex="-1"><a class="header-anchor" href="#_2-5-删除文档" aria-hidden="true">#</a> 2.5 删除文档</h3><ol><li><p><code>db.&lt;collection&gt;.remove(&lt;query&gt;,&lt;justOne&gt;)</code>：删除文档，默认删除多个（若第二个参数设为true，则只删除一个）</p><p>1）接收一个查询文档作为参数，只有符合条件的文档才会被删除，不能撤销</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 删除所有name为&#39;沙和尚&#39;的数据</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 删除name为&#39;沙和尚&#39;的第一条数据</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）如果传递一个空对象作为参数，则会删除所有文档</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 删除stus集合中的所有文档</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>3）数据库中的数据都不会删除，所以删除的方法很少调用，一般会在数据中添加一个字段，来表示数据是否被删除</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 为数据添加isDel属性，来代表是否删除</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">isDel</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isDel</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>db.&lt;collection&gt;.deleteOne()</code>：删除集合中的一个文档</p></li><li><p><code>db.&lt;collection&gt;.deleteMany()</code>：删除集合中的多个文档</p></li></ol><hr><h3 id="_2-6-操作符" tabindex="-1"><a class="header-anchor" href="#_2-6-操作符" aria-hidden="true">#</a> 2.6 操作符</h3><blockquote><p>使用操作符可以对文档的数据进行局部修改</p></blockquote><h4 id="_2-6-1-修改操作符" tabindex="-1"><a class="header-anchor" href="#_2-6-1-修改操作符" aria-hidden="true">#</a> 2.6.1 <a href="https://www.mongodb.com/docs/manual/reference/operator/update/" target="_blank" rel="noopener noreferrer">修改操作符<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><ol><li><p><code>$set</code>：用来指定一个字段的值，如果这个字段不存在，则创建它</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 仅修改name为&#39;沙和尚&#39;这条数据中的gender、address属性，而非替换整条数据</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;男&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;流沙河&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>$unset</code>：用来删除文档中一个不需要的字段，用法和set类似</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 仅删除name为&#39;沙和尚&#39;这条数据中的address属性</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">$unset</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;流沙河&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>$inc</code>：用来增加已有键的值，或者该键不存在则创建一个，只能用于Number类型的值</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 为所有薪资低于1000的员工增加工资400元</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$lte</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">$inc</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>$push</code>：向数组中添加一个新的元素</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;tangseng&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">$push</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;hobby.movies&#39;</span><span class="token operator">:</span> <span class="token string">&#39;Interstellar&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><code>$addToSet</code>：向数组中添加一个新元素，如果数组中已经存在了该元素，则不会添加</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;tangseng&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">$addToSet</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;hobby.movies&#39;</span><span class="token operator">:</span> <span class="token string">&#39;Interstellar&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><hr><h4 id="_2-6-2-查询操作符" tabindex="-1"><a class="header-anchor" href="#_2-6-2-查询操作符" aria-hidden="true">#</a> 2.6.2 <a href="https://www.mongodb.com/docs/manual/reference/operator/query/" target="_blank" rel="noopener noreferrer">查询操作符<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><ol><li><p>比较符：<code>$eq</code>：等于；<code>$ne</code>：不等于；<code>$lt</code>：小于；<code>$lte</code>：小于等于；<code>$gt</code>：大于；<code>$gte</code>：大于等于；<code>$in</code>：在数组中；<code>$nin</code>：不在数组中</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查询numbers中num大于500的文档</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">500</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查询numbers中num等于500的文档</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$eq</span><span class="token operator">:</span> <span class="token number">500</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查询numbers中num小于30的文档</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查询numbers中num大于40小于50的文档</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>逻辑符：<code>$and</code>：和；<code>$not</code>：非；<code>$or</code>：或；<code>$nor</code>：都不</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查询工资小于1000或大于2500的员工</span>
db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">$or</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">2500</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="_2-7-文档关系" tabindex="-1"><a class="header-anchor" href="#_2-7-文档关系" aria-hidden="true">#</a> 2.7 文档关系</h3><ol><li><p>一对一：可以通过内嵌文档的形式来体现出一对一的关系</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>wifeAndHusband<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;黄蓉&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">husband</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;郭靖&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;潘金莲&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">husband</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;武大郎&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>一对多：用户vs订单、文章vs评论</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;swk&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;zbj&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>order<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;牛肉&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;漫画&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&#39;59c47e35241d8d36a1d50de0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//查找用户swk的订单</span>
<span class="token keyword">var</span> user_id <span class="token operator">=</span> db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;zbj&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_id
db<span class="token punctuation">.</span>order<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">user_id</span><span class="token operator">:</span> user_id <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>多对多：分类vs商品、老师vs学生</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>teachers<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;洪七公&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;黄药师&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;龟仙人&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>stus<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;郭靖&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">teacherName</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;洪七公&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;黄药师&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">teacherName</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;洪七公&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;黄药师&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;龟仙人&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h2 id="第3章-mongoose" tabindex="-1"><a class="header-anchor" href="#第3章-mongoose" aria-hidden="true">#</a> 第3章 Mongoose</h2><blockquote><p>官网：<a href="https://mongoosejs.com/docs/guide.html" target="_blank" rel="noopener noreferrer">https://mongoosejs.com/docs/guide.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h3 id="_3-1-mongoose简介" tabindex="-1"><a class="header-anchor" href="#_3-1-mongoose简介" aria-hidden="true">#</a> 3.1 Mongoose简介</h3><ol><li><p>定义：用Node来操作MongoDB的模块，是一个对象文档模型(ODM)库，用来把结构化的模式应用到一个MongoDB集合，并提供了验证和类型转换等好处</p></li><li><p>特点：</p><p>1）可以为文档创建一个模式结构(Schema)</p><p>2）可以对模型中的对象/文档进行验证</p><p>3）数据可以通过类型转换转换为对象模型</p><p>4）可以使用中间件来应用业务逻辑挂钩</p><p>5）比Node原生的MongoDB驱动更容易</p></li><li><p>新的对象：</p><p>1）Schema(模式对象)：定义约束了数据库中的文档结构</p><p>2）Model：作为集合中的所有文档的表示，相当于MongoDB数据库中的集合collection</p><p>3）Document：表示集合中的具体文档，相当于集合中的一个具体的文档</p></li></ol><hr><h3 id="_3-2-连接mongodb" tabindex="-1"><a class="header-anchor" href="#_3-2-连接mongodb" aria-hidden="true">#</a> 3.2 连接MongoDB</h3><ol><li><p>连接MongoDB数据库后，底层的<code>Connection</code>对象就可以通过mongoose模块的<code>conection</code>属性来访问</p></li><li><p><code>connection</code>对象是对数据库连接的抽象，它提供了对象连接、底层的db对象和表示结合的Model对象的访问</p><p>1）可以对<code>connection</code>对象上的一些事件进行监听，来获悉数据库连接的开始与端开</p><p>2）例：可以通过<code>open</code>和<code>close</code>事件来监控连接的打开和关闭</p></li><li><p>安装mongoose：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i mongoose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>引入mongoose：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>连接数据库：如果端口号是默认端口号（27017），可以省略不写</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://数据库的ip地址:端口号/数据库名&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">useMongoClient</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>数据库连接成功的事件：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;数据库连接成功!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>数据库断开的事件：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;数据库连接断开!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>断开连接：一般不需要调用</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mongoose<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><hr><h3 id="_3-3-schema模式对象" tabindex="-1"><a class="header-anchor" href="#_3-3-schema模式对象" aria-hidden="true">#</a> 3.3 Schema模式对象</h3><ol><li><p>作用：模式就是对文档的约束，文档中的字段必须符合模式的规定，否则将不能正常操作</p></li><li><p>定义模式：对在模式中的每个字段都需要定一个特定的值类型</p><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>String、Number、Boolean、Array、Buffer、Date、ObjectId(Oid)、Mixed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>创建模式定义：模式需要通过mongoose的Schema属性来创建，这个属性是一个构造函数</p><p>1）语法：<code>new Schema(definition,option)</code></p><p>2）参数：definition（描述模式）、options（配置对象，定义与数据库中集合的交互）</p><table><thead><tr><th>options选项</th><th>说明</th></tr></thead><tbody><tr><td>autoIndex</td><td>布尔值，开启自动索引，默认true</td></tr><tr><td>bufferCommands</td><td>布尔值，缓存由于连接问题无法执行的语句，默认true</td></tr><tr><td>capped</td><td>集合中最大文档数量</td></tr><tr><td>collection</td><td>指定应用Schema的集合名称</td></tr><tr><td>id</td><td>布尔值，是否有应用于_id的id处理器，默认true</td></tr><tr><td>_id</td><td>布尔值，是否自动分配id字段，默认true</td></tr><tr><td>strict</td><td>布尔值，不符合Schema的对象不会被插入进数据库，默认true</td></tr></tbody></table></li><li><p>案例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建并连接数据库</span>
<span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://127.0.0.1/mongoose_test&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">useMongoClient</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;数据库连接成功!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 将mongoose.Schema 赋值给一个变量</span>
<span class="token keyword">var</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema

<span class="token comment">// 创建Schema（模式）对象</span>
<span class="token keyword">var</span> stuSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;female&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">address</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 通过Schema来创建Model：mongoose.model(modelName, schema)</span>
<span class="token comment">// modelName：要映射的集合名，mongoose会自动将集合名变成复数！（如果已经是复数则不变了）</span>
<span class="token keyword">var</span> StuModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;student&#39;</span><span class="token punctuation">,</span> stuSchema<span class="token punctuation">)</span>	 <span class="token comment">// 名称自动变为students</span>

<span class="token comment">// 向数据库中插入一个文档：modelName.create(doc, function(err){})</span>
StuModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;白骨精&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
    <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;白骨洞&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;插入成功~~~&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="_3-4-model模型对象" tabindex="-1"><a class="header-anchor" href="#_3-4-model模型对象" aria-hidden="true">#</a> 3.4 Model模型对象</h3><blockquote><p>Model对象：相当于数据库中的集合，通过Model可以完成对集合的CRUD操作</p></blockquote><ul><li>工作流程：定义Schema对象后，就需要通过该Schema对象来创建Model对象；创建Model对象后，就会自动和数据库中对应的集合建立连接，以确保在应用更改时，集合已经创建并具有适当的索引，且设置了必须性和唯一性</li></ul><h4 id="_3-4-1-创建model" tabindex="-1"><a class="header-anchor" href="#_3-4-1-创建model" aria-hidden="true">#</a> 3.4.1 创建Model</h4><ol><li><p>语法：<code>mongoose.model(name,[schema],[collection],[skipInit])</code></p></li><li><p>参数：</p><ul><li><code>name</code>：模型的名字，用于查找模型</li><li><code>schema</code>：创建好的模式对象</li><li><code>collection</code>：要连接的集合名</li><li><code>skipInit</code>：是否跳过初始化，默认false</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建并连接数据库</span>
<span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://127.0.0.1/mongoose_test&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">useMongoClient</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;数据库连接成功!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema
<span class="token keyword">var</span> stuSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;female&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">address</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> StuModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;student&#39;</span><span class="token punctuation">,</span> stuSchema<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h4 id="_3-4-2-创建文档" tabindex="-1"><a class="header-anchor" href="#_3-4-2-创建文档" aria-hidden="true">#</a> 3.4.2 创建文档</h4><ol><li><p>语法：<code>Model.create(doc(s),[callback])</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;沙和尚&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span><span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;male&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;流沙河&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span><span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;male&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;花果山&#39;</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h4 id="_3-4-3-查询文档" tabindex="-1"><a class="header-anchor" href="#_3-4-3-查询文档" aria-hidden="true">#</a> 3.4.3 查询文档</h4><ol><li><p><code>Model.find(conditions,[projection],[options],[callback])</code>：查询所有符合条件的文档，返回一个数组</p></li><li><p><code>Model.findOne([conditions],[projection],[options],[callback])</code>：查询符合条件的第一个文档，返回一个具体的文档对象</p></li><li><p><code>Model.findById(id,[projection],[options],[callback])</code>：根据文档的id属性查询文档</p></li><li><p>参数说明：</p><p>1）<code>conditions</code>：查询的条件</p><p>2）<code>projection</code>：投影，语法1：<code>{name:1, _id:0}</code>，语法2：<code>&quot;name -_id&quot;</code></p><p>3）<code>options</code>：查询选项，可指定<code>skip</code>、<code>limit</code></p><p>4）<code>callback</code>：回调函数(必填)，查询结果会通过回调函数返回</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 查找name为&#39;唐僧&#39;的文档</span>
StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;唐僧&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查询所有文档，只显示name列</span>
StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查询所有文档，只显示name、age列，从第4条开始显示，仅显示一条数据</span>
StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;name age -_id&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">skip</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 查询第1条文档</span>
StuModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 按ID查询文档</span>
StuModel<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&#39;59c4c3cf4e5483191467d392&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回的对象就是Document文档对象，是Model的实例</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc <span class="token keyword">instanceof</span> <span class="token class-name">StuModel</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h4 id="_3-4-4-修改文档" tabindex="-1"><a class="header-anchor" href="#_3-4-4-修改文档" aria-hidden="true">#</a> 3.4.4 修改文档</h4><ol><li><p><code>Model.update(conditions,doc,[options],[callback])</code></p></li><li><p><code>Model.updateMany(conditions,doc,[options],[callback])</code></p></li><li><p><code>Model.updateOne(conditions,doc,[options],[callback])</code></p></li><li><p><code>Model.replaceOne(conditions,doc,[options],[callback])</code></p></li><li><p>参数说明：</p><p>1）<code>conditions</code>：查询条件</p><p>2）<code>doc</code>：修改后的对象</p><p>3）<code>options</code>：配置参数</p><p>4）<code>callback</code>：回调函数</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 修改唐僧的年龄为20</span>
StuModel<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;唐僧&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;修改成功&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h4 id="_3-4-5-删除文档" tabindex="-1"><a class="header-anchor" href="#_3-4-5-删除文档" aria-hidden="true">#</a> 3.4.5 删除文档</h4><ol><li><p><code>Model.remove(conditions,[callback])</code></p></li><li><p><code>Model.deleteOne(conditions,[callback])</code></p></li><li><p><code>Model.deleteMany(conditions,[callback])</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 删除name为&#39;白骨精&#39;的文档</span>
StuModel<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;白骨精&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;删除成功~~&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h4 id="_3-4-6-统计数量" tabindex="-1"><a class="header-anchor" href="#_3-4-6-统计数量" aria-hidden="true">#</a> 3.4.6 统计数量</h4><ol><li><p>语法：<code>Model.count(conditions,[callback])</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 统计StuModel中的文档数量</span>
StuModel<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="_3-5-document文档对象" tabindex="-1"><a class="header-anchor" href="#_3-5-document文档对象" aria-hidden="true">#</a> 3.5 Document文档对象</h3><blockquote><p>通过Model对数据库进行查询时，会返回Document对象或Document对象数组，Document继承自Model，代表一个集合中的文档</p></blockquote><ol><li><p>创建文档：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 引入模块：创建并连接数据库</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./tools/conn_mongo&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema
<span class="token keyword">var</span> stuSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;female&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">address</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> StuModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;student&#39;</span><span class="token punctuation">,</span> stuSchema<span class="token punctuation">)</span>

<span class="token comment">// 创建一个Document</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StuModel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;奔波霸&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">48</span><span class="token punctuation">,</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&#39;male&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;碧波潭&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>保存文档：<code>save([options],[callback])</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>stu<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;保存成功!&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改文档：<code>update(update,[options],[callback])</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法1</span>
    doc<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;修改成功!&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 方法2</span>
    doc<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span>
    doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>删除文档：<code>remove([callback])</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    doc<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;大师兄再见!&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获取文档中的指定属性值：<code>get(name)</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法1</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 方法2</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>设置文档的指定的属性值：<code>set(name, value)</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法1</span>
    doc<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;孙大圣&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 方法2</span>
    doc<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;孙大圣&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获取文档的_id属性值：<code>_id</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>_id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>转换为一个JSON对象：<code>toJSON()</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> j <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>将文档转换为一个普通的JS对象（所有文档的属性和方法都不可用）：<code>toObject()</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;孙悟空&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    doc <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 用JS方法操作</span>
    <span class="token keyword">delete</span> doc<span class="token punctuation">.</span>address
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>_id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h3 id="_3-6-mongoose模块化" tabindex="-1"><a class="header-anchor" href="#_3-6-mongoose模块化" aria-hidden="true">#</a> 3.6 Mongoose模块化</h3><ol><li><p>tools/conn_mongo.js：连接数据库</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建并连接数据库</span>
<span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://127.0.0.1/mongoose_test&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">useMongoClient</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;数据库连接成功!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>models/student.js：定义模型</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema
<span class="token keyword">var</span> stuSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;female&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">address</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> StuModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;student&#39;</span><span class="token punctuation">,</span> stuSchema<span class="token punctuation">)</span>
<span class="token comment">// 暴露模型</span>
model<span class="token punctuation">.</span>exports <span class="token operator">=</span> StuModel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>index.js：引入模块</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./tools/conn_mongo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> Student <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./model/student&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// 自定义操作</span>
StuModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;唐僧&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: dr_neutron@126.com">Jason Zhou</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/WebNotebook/server/nodejs.html" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/WebNotebook/assets/app.a696b835.js" defer></script>
  </body>
</html>
